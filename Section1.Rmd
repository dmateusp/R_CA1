---
title: "- Data Understanding and Data Exploration"
output: html_notebook
---
# EuroCom

### Dependencies
```{r}
#install.packages("ggplot2")
library(ggplot2)
```

## Reading the dataset

```{r}
phones <- read.csv("./eurocomPHONEchurners.csv")
head(phones)
```

## Data pre-processing

Getting how many null values there is per column.

```{r}
count_na <- sapply(phones, function(y) sum(length(which(is.na(y) | y == ""))))
na_df <- data.frame(count_na)

subset(na_df, na_df$count_na > 0)
```
### Replacing na numerics with medians
```{r}
replace_na_with_median <- function(col) {
  median_without_na <- median(col, na.rm=TRUE)
  col[is.na(col)] <- median_without_na
  return(col)
}
```
### MINUTES_3MONTHS_AGO
```{r}
phones$MINUTES_3MONTHS_AGO <- replace_na_with_median(phones$MINUTES_3MONTHS_AGO)
```
### CUST_MOS
```{r}
phones$CUST_MOS <- replace_na_with_median(phones$CUST_MOS)
```
### TOT_MINUTES_USAGE
```{r}
phones$TOT_MINUTES_USAGE <- replace_na_with_median(phones$TOT_MINUTES_USAGE)
```


### Getting the mode for categorical columns
```{r}
get_mode <- function(x){
  xtable <- table(x)
  idx <- xtable == max(xtable)
  names(xtable)[idx]
}
```
### PHONE_PLAN
```{r}
phones$PHONE_PLAN[phones$PHONE_PLAN == ""] <- get_mode(phones$PHONE_PLAN)
```
### EDUCATION
```{r}
phones$EDUCATION[phones$EDUCATION == ""] <- get_mode(phones$EDUCATION)
```


### Discretising Income predictor values
```{r}
head(phones$INCOME)
```

```{r}
phones$INCOME <- cut(phones$INCOME, breaks = c(0, 37999, 88000, max(phones$INCOME)), include.lowest = TRUE, labels = c("Low Income", "Medium Income","High Income"))

head(phones$INCOME)
```

### Studying the distribution of the numeric attributes

### CUST_MOS
```{r}
ggplot(data=phones ,aes(phones$CUST_MOS)) + geom_histogram(binwidth=8,aes(y = ..density..))  + scale_x_continuous(breaks = seq(0,60,5)) + scale_y_continuous(breaks = seq(0,1000,50)) + labs(x="Customer loyalty(sequential months)" ,y="Number of persons", title="Customer loyalty (+ density)") + geom_density()
```
### NUM_LINES
```{r}
ggplot(data=phones ,aes(phones$NUM_LINES)) + geom_histogram(binwidth=1) + scale_x_continuous(breaks = 0:3) + labs(x="Number of lines" ,y="Number of persons")
```
### TOT_MINUTES_USAGE
```{r}
ggplot(data=phones ,aes(phones$TOT_MINUTES_USAGE)) + geom_histogram(bins = 30, aes(y = ..density..)) +  scale_x_continuous(breaks = seq(0, 30000, 3000)) + labs(x="Total minutes usage" ,y="Number of persons (density)") + geom_density()
```

### Distribution of nominal attributes

### INCOME
```{r}
ggplot(data=phones ,aes(phones$INCOME)) + geom_histogram(stat="count") + labs(x="Income" ,y="Number of persons")
```
### PHONE_PLAN
```{r}
ggplot(data=phones ,aes(phones$PHONE_PLAN)) + geom_histogram(stat="count") + labs(x="Phone plan" ,y="Number of persons")
```
### EDUCATION
```{r}
ggplot(data=phones ,aes(phones$EDUCATION)) + geom_histogram(stat="count")   + labs(x="Education" ,y="Number of persons")
```
### Seeing the influence on churn
### INCOME
```{r}
ggplot(data=phones ,aes(x=phones$INCOME, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(stat="count") + theme_bw()   + labs(x="Income" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```
### PHONE_PLAN
```{r}
ggplot(data=phones ,aes(x=phones$PHONE_PLAN, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(stat="count") + theme_bw()   + labs(x="Phone plan" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```

### TOT_MINUTES_USAGE
```{r}
ggplot(data=phones ,aes(x=phones$TOT_MINUTES_USAGE, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(bins = 5) +  scale_x_continuous(breaks = seq(0, 30000, 5000))  + labs(x="Total minutes usage" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```

### CUST_MOS
```{r}
ggplot(data=phones ,aes(x=phones$CUST_MOS, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(binwidth=5) + scale_x_continuous(breaks = seq(0,50,5))   + labs(x="Customer loyalty (sequential months)" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```
### NUM_LINES
```{r}
ggplot(data=phones ,aes(x=phones$NUM_LINES, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(binwidth=1, position="dodge") + scale_x_continuous(breaks = 0:3)   + labs(x="Number of lines" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```
### EDUCATION
```{r}
ggplot(data=phones ,aes(x=phones$EDUCATION, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(stat="count")  + labs(x="Education" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```
### GENDER
```{r}
ggplot(data=phones ,aes(x=phones$GENDER, group=phones$CHURNER, fill=phones$CHURNER)) + geom_histogram(stat="count", position="dodge")  + labs(x="Gender" ,y="Number of persons", title="Looking for disproportions in Churning rates", fill="Churner")
```

### Skewness of numerical attributes
### CUST_MOS
```{r}
cust_mos_skew <-(3*(mean(phones$CUST_MOS)-median(phones$CUST_MOS)))/sd(phones$CUST_MOS)
cust_mos_skew
```
### NUM_LINES
```{r}
num_lines_skew <-(3*(mean(phones$NUM_LINES)-median(phones$NUM_LINES)))/sd(phones$NUM_LINES)
num_lines_skew
```
### TOT_MINUTES_USAGE
```{r}
tot_minutes_usage_skew <-(3*(mean(phones$TOT_MINUTES_USAGE)-median(phones$TOT_MINUTES_USAGE)))/sd(phones$TOT_MINUTES_USAGE)
tot_minutes_usage_skew
```

### CORRELATION
### Minutes of usage
```{r}
ggplot(data=phones ,aes(x=phones$TOT_MINUTES_USAGE, y=phones$MINUTES_CURR_MONTH + phones$MINUTES_PREV_MONTH + phones$MINUTES_3MONTHS_AGO)) + geom_point() + labs(x="Total minutes usage" ,y="Addition of minutes current month, last month, 3 months ago", title="Correlation between minutes of usage")
```

### OUTLIERS

### CUST_MOS
```{r}
ggplot(data=phones ,aes(phones$CHURNER, phones$CUST_MOS)) + geom_boxplot() + labs(x="Churner" ,y="Customer loyalty")
```
### TOT_MINUTES_USAGE
```{r}
ggplot(data=phones ,aes(phones$CHURNER, phones$TOT_MINUTES_USAGE)) + geom_boxplot() + labs(x="Churner" ,y="Total minutes of usage")
```
Finding outliers mathematically in TOT_MINUTES_USAGE

IQR method
```{r}
summary(phones$TOT_MINUTES_USAGE)
IQR <- 1677-116
lower_bound <- 116 - (IQR*1.5)
upper_bound <- 1677 + (IQR*1.5)

nrow(phones[phones$TOT_MINUTES_USAGE < lower_bound | phones$TOT_MINUTES_USAGE > upper_bound,])
```
Z standardisation method
```{r}
# Z score
z_score_tot_minutes_usage <- scale(phones$TOT_MINUTES_USAGE, center = TRUE, scale = TRUE)
# same as (phones$TOT_MINUTES_USAGE - mean(phones$TOT_MINUTES_USAGE))/sd(phones$TOT_MINUTES_USAGE)
summary(z_score_tot_minutes_usage)
IQR_Z <- -0.07354 - -0.39323
lower_bound_z <- -0.39323 - (IQR*1.5)
upper_bound_z <- -0.07354 + (IQR*1.5)

z_range <- table(z_score_tot_minutes_usage > -3 & z_score_tot_minutes_usage < 3)
z_range[names(z_range)==FALSE]

```

